### **项目开发计划：智能学生分组助手**

#### 1. 项目概述

**项目名称**：智能学生分组助手 (Intelligent Student Grouping Assistant)

**项目目标**：开发一款纯前端的 Web 应用，旨在帮助教师和教学助理根据学生的问卷调查数据（Excel）、基本信息和特定分组需求，自动化并优化学生分组流程。应用需提供灵活的权重调节功能，并能一键生成多种格式的分析报告与分组结果。

**核心特性**：
* **数据驱动**：直接处理 Excel 问卷数据和学生照片。
* **智能分组**：内置可调节权重的优化算法，支持多种分组策略。
* **数据可视化**：提供班级和小组的学习风格画像分析。
* **报告生成**：一键导出分组 Excel、班级分析 PDF 和批量个人报告。
* **跨平台与高隐私性**：纯前端实现，无需安装，数据全程在用户本地处理。

#### 2. 技术架构与选型

为确保开发效率、应用性能和用户体验，本项目选用以下现代化技术栈：

* **前端框架**: **React (v18+)** + **Vite**
    * *理由*：React 拥有庞大且成熟的生态系统。Vite 提供极速的开发服务器和高效的构建能力。
* **编程语言**: **TypeScript**
    * *理由*：提供静态类型检查，增强代码的可维护性和健壮性，是复杂数据处理项目的首选。
* **UI 组件库**: **Ant Design (AntD v5+)**
    * *理由*：提供一整套高质量、企业级的 UI 组件（上传、表格、滑块、卡片等），能极大加速 UI 开发。
* **Excel 文件处理**: **SheetJS (xlsx)**
    * *理由*：在前端处理 Excel 文件的行业标准库，功能强大，支持读写。
* **数据可视化**: **Apache ECharts for React**
    * *理由*：功能极其丰富的图表库，尤其适合展示雷达图等多维数据分析。
* **PDF 生成**: **jsPDF** + **html2canvas**
    * *理由*：黄金组合。通过 `html2canvas` 将 React 组件（报告样式）转换为图像，再由 `jsPDF` 嵌入 PDF，完美复现复杂样式。
* **文件打包**: **JSZip**
    * *理由*：在前端创建 `.zip` 压缩包，用于批量导出个人报告。
* **状态管理**: **Zustand**
    * *理由*：轻量、简洁的状态管理库，对本项目规模而言，比 Redux 更易于上手和维护。

#### 3. 应用流程与页面详细设计

应用采用单页应用（SPA）架构，通过路由或状态切换呈现三个主要页面/步骤。

##### **页面一：数据上传与准备 (Data Upload & Preparation)**

* **UI 布局**：
    1.  **顶部标题**：清晰的标题“第一步：上传您的数据”。
    2.  **上传区域**：使用 AntD 的 `Upload.Dragger` 组件，并列或垂直排列三个上传框：
        * **问卷数据 (Excel)**：主上传区，接受 `.xlsx` 文件。
        * **学生照片 (文件夹/ZIP)**：接受文件夹或 `.zip` 文件。
        * **（可选）完整学生名单 (Excel)**：用于比对未测试者。
    3.  **数据预览区**：上传成功后，下方出现一个 `Tabs` (标签页) 组件：
        * **Tab 1: 数据总览**：显示关键信息卡片，如“总人数”、“已测试人数”、“未匹配照片数”、“已自由分组人数”。
        * **Tab 2: 学生数据预览**：使用 AntD 的 `Table` 组件，分页展示解析出的学生数据，包含姓名、学号、学习风格原始得分等。
    4.  **操作按钮**：右下角一个醒目的“下一步：设置分组规则”按钮，数据未准备好时禁用。

* **功能逻辑**：
    1.  **文件读取**：
        * **Excel**：使用 `SheetJS` 读取文件。根据预设的列名（“姓名”, “学号”, “组队/测试情况”, “学习主动性总分”等）自动匹配数据字段。
        * **照片**：解析文件夹或 `JSZip` 解压后的文件列表，根据文件名（学号或姓名）与学生数据建立映射。
    2.  **数据处理与校验**：
        * 计算每位学生的学习风格得分（根据问卷题目）。
        * 识别“组队/测试情况”列中的“自由组队”学生，并将其状态标记。
        * 通过对比完整名单和问卷数据，找出未测试学生。
        * 在 `Table` 中高亮显示数据异常的行（如照片未匹配）。
    3.  **状态存储**：将处理好的学生数据数组、已分组学生数组、未测试学生数组存入 Zustand store。

##### **页面二：分组规则与权重调节 (Grouping Rules & Configuration)**

* **UI 布局**：
    1.  **顶部标题**：“第二步：配置您的分组任务”。
    2.  **任务管理区**：允许用户创建多个分组任务（例如，“实验组”、“对照组”）。每个任务是一个可折叠的卡片。
    3.  **任务卡片内部**：
        * **任务名称**：输入框，默认为“分组任务1”。
        * **选择学生**：下拉多选框或穿梭框，让用户从未分组的学生中选择要参与此任务的学生。
        * **分组模式**：`Radio.Group` 单选按钮，选项为“学习风格优化分组”和“均衡随机分组”。
        * **小组人数**：`InputNumber` 数字输入框。
        * **权重调节器**：一个独立的区域，包含多个带标签的 `Slider` (滑块)，范围 0-100：
            * `[通用]` 性别均衡度
            * `[通用]` 学科均衡度
            * `[通用]` 学习主动性均衡度
            * `[通用]` 组长候选人分布
            * `[模式A]` 组内学习风格异质性
            * `[模式A]` 组间风格构成同质性
    4.  **操作按钮**：页面底部一个“开始智能分组”按钮。

* **功能逻辑**：
    1.  **动态 UI**：根据用户选择的“分组模式”，动态显示或隐藏与学习风格相关的滑块。
    2.  **状态绑定**：所有输入框和滑块的值都与 Zustand store 中对应的任务配置对象绑定。
    3.  **算法触发**：点击“开始智能分组”按钮后，从 store 中获取所有学生数据和所有任务配置，传递给核心分组算法，并导航到下一页。

##### **页面三：结果预览与导出 (Results & Export)**

* **UI 布局**：
    1.  **顶部标题**：“第三步：预览、微调并导出结果”。
    2.  **结果展示区**：使用 `Tabs`，每个标签对应一个分组任务。
    3.  **Tab 内部**：
        * **分组看板**：使用 AntD 的 `Card` 组件，每个卡片代表一个小组。卡片内显示：
            * 小组编号和统计信息（如平均主动性分、男女比例）。
            * 成员列表，每个成员包含头像、姓名、学号。
        * **可视化报告**：在看板旁边或下方，使用 `ECharts` 组件展示：
            * 班级整体学习风格雷达图。
            * 每个小组的平均学习风格雷达图，用于对比。
    4.  **导出操作区**：一组 `Button`：
        * “导出分组结果 (Excel)”
        * “导出班级分析报告 (PDF)”
        * “批量导出个人报告 (ZIP)”

* **功能逻辑**：
    1.  **分组算法**（核心）：
        * 接收学生数据和配置，对每个任务执行分组。
        * **初始化**：随机将学生分配到小组。
        * **迭代优化**：执行 N 次迭代。每次迭代中，随机选择两个不同小组的学生进行交换，计算交换后的“总质量分”。如果分数提高，则保留交换；否则，有一定概率（模拟退火思想）也保留交换以跳出局部最优。
        * **质量分函数 `calculateScore(groups, config)`**：此函数是算法的关键。它根据配置中的权重，计算当前分组方案的总分，总分 = Σ (各平衡项得分 * 对应权重)。
            * **性别均衡分**：计算每组男女比例与班级总比例的方差，方差越小分越高。
            * **学科均衡分**：计算每组学科种类的数量或信息熵，种类越多/熵越高分越高。
            * **主动性均衡分**：计算各组平均“学习主动性总分”的方差，方差越小分越高。
            * **组长分布分**：计算没有“组长候选人”的小组数量，数量越少分越高。
            * **风格异质分（组内）**：计算每个小组内成员间学习风格向量的平均欧氏距离，距离越大分越高。
            * **风格同质分（组间）**：计算每个小组的“平均风格向量”与“所有小组的中心向量”的距离方差，方差越小分越高。
    2.  **手动微调**：为小组卡片和成员列表增加拖拽功能（使用 `dnd-kit` 等库），允许用户手动调整。拖拽结束后，重新计算并实时更新该小组和相关小组的统计数据。
    3.  **导出实现**：
        * **Excel**：使用 `SheetJS` 将分组数据转换为工作表并触发下载。
        * **PDF (报告)**：将可视化图表和统计数据渲染到一个隐藏的、专门用于打印的 React 组件中，然后调用 `html2canvas` 和 `jsPDF` 生成文件。
        * **ZIP (个人报告)**：遍历所有学生，为每个人动态生成个人报告组件，依次转为 PDF，然后使用 `JSZip` 将所有 PDF 添加到压缩包中并触发下载。

#### 4. 开发步骤与里程碑

1.  **里程碑 1：项目搭建与数据导入 (预计 3 天)**
    * [ ] 使用 Vite 初始化 React + TypeScript 项目。
    * [ ] 安装 AntD, SheetJS, Zustand 等核心依赖。
    * [ ] 完成**页面一**的静态 UI 布局。
    * [ ] 实现 Excel 文件读取、解析和数据校验逻辑。
    * [ ] 实现学生数据在预览表格中的展示。

2.  **里程碑 2：核心逻辑与配置界面 (预计 4 天)**
    * [ ] 设计并实现学习风格得分的计算模型。
    * [ ] 完成**页面二**的 UI 布局，包括动态任务卡片和所有调节滑块。
    * [ ] 实现页面 UI 与 Zustand store 的双向数据绑定。
    * [ ] 编写分组算法的框架，包括初始化和迭代逻辑。

3.  **里程碑 3：算法实现与结果展示 (预计 5 天)**
    * [ ] 详细实现“质量分函数”中的每一个评分项。
    * [ ] 将算法与 UI 连接，实现点击按钮后执行分组。
    * [ ] 完成**页面三**的分组结果看板 UI，动态渲染分组卡片和成员。
    * [ ] 实现 ECharts 可视化图表，展示班级和小组的学习风格。

4.  **里程碑 4：导出功能与最终完善 (预计 4 天)**
    * [ ] 实现导出分组结果到 Excel 的功能。
    * [ ] 实现班级分析报告和个人学习报告的 React 组件样式。
    * [ ] 集成 jsPDF, html2canvas, JSZip，完成三种报告的导出功能。
    * [ ] 实现手动拖拽微调功能。
    * [ ] 进行全面的测试、Bug 修复和 UI 优化。

**总计预估开发时间**：16个工作日。

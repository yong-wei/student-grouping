# éƒ¨ç½²æ–‡ä»¶æ¸…å•

## âœ… å·²ç”Ÿæˆçš„æ–‡ä»¶

### ğŸ“¦ æ ¸å¿ƒéƒ¨ç½²æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| `Dockerfile` | Docker é•œåƒæ„å»ºæ–‡ä»¶ | å¤šé˜¶æ®µæ„å»º,Node.js ç¼–è¯‘ + Nginx æœåŠ¡,AMD64 æ¶æ„ |
| `docker-compose.yml` | Docker Compose é…ç½® | å®¹å™¨ç¼–æ’,ç«¯å£æ˜ å°„ 8081:80,Podman å…¼å®¹ |
| `.dockerignore` | æ„å»ºæ’é™¤è§„åˆ™ | æ’é™¤ node_modules, logs, docs ç­‰,å‡å°é•œåƒä½“ç§¯ |

### ğŸ”§ éƒ¨ç½²è„šæœ¬

| è„šæœ¬ | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `build.sh` | æ„å»º AMD64 é•œåƒ | æœ¬åœ° Mac ARM64 è·¨å¹³å°æ„å»º |
| `deploy.sh` | å¯åŠ¨/é‡å¯å®¹å™¨ | æœåŠ¡å™¨ä¸Šå¿«é€Ÿéƒ¨ç½² |
| `save-image.sh` | å¯¼å‡ºé•œåƒä¸º tar.gz | ç¦»çº¿éƒ¨ç½²,ä¸Šä¼ åˆ°æœåŠ¡å™¨ |
| `stop.sh` | åœæ­¢å®¹å™¨ | ç»´æŠ¤æ—¶åœæ­¢æœåŠ¡ |

### ğŸ“„ é…ç½®æ–‡ä»¶

#### å®¹å™¨é…ç½® (`nginx/`)
- `nginx/default.conf` - å®¹å™¨å†… Nginx é…ç½®
  - SPA è·¯ç”±æ”¯æŒ (try_files fallback)
  - ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶ 50MB
  - Gzip å‹ç¼©
  - é™æ€èµ„æºç¼“å­˜

#### å®¿ä¸»æœºé…ç½® (`nginx-vhost/`)
- `nginx-vhost/group.adapt-learn.online.conf` - Nginx è™šæ‹Ÿä¸»æœºé…ç½®
  - HTTP è‡ªåŠ¨é‡å®šå‘ HTTPS
  - SSL/TLS é…ç½®
  - åå‘ä»£ç†åˆ°å®¹å™¨ 8081 ç«¯å£
  - å®‰å…¨å“åº”å¤´
- `nginx-vhost/ssl-setup.sh` - SSL è¯ä¹¦è‡ªåŠ¨é…ç½®è„šæœ¬
  - è‡ªåŠ¨å®‰è£… Certbot
  - ä½¿ç”¨ Let's Encrypt è·å–è¯ä¹¦
  - é…ç½®è‡ªåŠ¨ç»­æœŸ

### ğŸ“š æ–‡æ¡£

| æ–‡æ¡£ | å†…å®¹ | ç›®æ ‡è¯»è€… |
|------|------|----------|
| `README.md` | éƒ¨ç½²åŒ…æ€»è§ˆ | é¦–æ¬¡æ¥è§¦éƒ¨ç½²åŒ…çš„äºº |
| `QUICKSTART.md` | 5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½² | éœ€è¦å¿«é€Ÿéƒ¨ç½²çš„ç”¨æˆ· |
| `DEPLOYMENT.md` | å®Œæ•´éƒ¨ç½²æŒ‡å— | éœ€è¦è¯¦ç»†äº†è§£æ¯ä¸€æ­¥çš„ç”¨æˆ· |

### ğŸ“ æºç ç›®å½•

| ç›®å½• | è¯´æ˜ |
|------|------|
| `app/` | é¡¹ç›®å®Œæ•´æºç ,æ„å»ºæ—¶ä½¿ç”¨ |

## ğŸ¯ éƒ¨ç½²æµç¨‹

```
1. æœ¬åœ°æ„å»º
   â”œâ”€â”€ build.sh          â†’ æ„å»º AMD64 é•œåƒ
   â””â”€â”€ save-image.sh     â†’ å¯¼å‡º student-grouping-amd64.tar.gz

2. ä¸Šä¼ æ–‡ä»¶
   â”œâ”€â”€ scp *.tar.gz      â†’ ä¸Šä¼ é•œåƒæ–‡ä»¶
   â””â”€â”€ scp *.conf        â†’ ä¸Šä¼ é…ç½®æ–‡ä»¶

3. æœåŠ¡å™¨éƒ¨ç½²
   â”œâ”€â”€ podman load       â†’ å¯¼å…¥é•œåƒ
   â”œâ”€â”€ podman run        â†’ å¯åŠ¨å®¹å™¨
   â”œâ”€â”€ nginx config      â†’ é…ç½®åå‘ä»£ç†
   â””â”€â”€ ssl-setup.sh      â†’ é…ç½® SSL è¯ä¹¦

4. éªŒè¯
   â”œâ”€â”€ http://121.40.124.135:8081
   â””â”€â”€ https://group.adapt-learn.online
```

## ğŸŒ è®¿é—®æ–¹å¼

éƒ¨ç½²å®Œæˆåæœ‰ä»¥ä¸‹è®¿é—®æ–¹å¼:

1. **ç›´æ¥ IP è®¿é—®** (æ— éœ€ Nginx åå‘ä»£ç†)
   - http://121.40.124.135:8081

2. **å­åŸŸåè®¿é—®** (éœ€é…ç½® Nginx åå‘ä»£ç†)
   - http://group.adapt-learn.online (è‡ªåŠ¨é‡å®šå‘ HTTPS)
   - https://group.adapt-learn.online (æ¨è)

3. **åŸåŸŸåä¿æŒä¸å˜**
   - https://adapt-learn.online (åŸç½‘ç«™)

## ğŸ”’ å®‰å…¨æ€§

- âœ… HTTPS/SSL æ”¯æŒ (Let's Encrypt å…è´¹è¯ä¹¦)
- âœ… è‡ªåŠ¨ HTTP â†’ HTTPS é‡å®šå‘
- âœ… å®‰å…¨å“åº”å¤´ (HSTS, X-Frame-Options, CSP)
- âœ… å®¹å™¨éš”ç¦»
- âœ… æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶

## ğŸ“Š æŠ€æœ¯æ ˆ

### æ„å»ºç¯å¢ƒ
- **å¹³å°**: macOS (ARM64)
- **å·¥å…·**: Docker / Podman
- **Node.js**: 20.18.1
- **æ„å»ºå·¥å…·**: Vite 7.x

### è¿è¡Œç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**: Alibaba Cloud Linux 3.2104 LTS
- **æ¶æ„**: AMD64 (x86_64)
- **å®¹å™¨è¿è¡Œæ—¶**: Podman
- **Web æœåŠ¡å™¨**: Nginx 1.27 (Alpine)
- **åå‘ä»£ç†**: Nginx (å®¿ä¸»æœº)

## ğŸ“ æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         äº’è”ç½‘                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚
        â”‚  é˜¿é‡Œäº‘æœåŠ¡å™¨    â”‚
        â”‚  121.40.124.135 â”‚
        â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         â”‚
    â”‚  Nginx (å®¿ä¸»æœº)          â”‚
    â”‚  - Port 80/443          â”‚
    â”‚  - SSL ç»ˆæ­¢              â”‚
    â”‚  - è™šæ‹Ÿä¸»æœºè·¯ç”±          â”‚
    â”‚                         â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                   â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ adapt-learn   â”‚          â”‚ group.adapt-learn  â”‚
â”‚ .online       â”‚          â”‚ .online            â”‚
â”‚               â”‚          â”‚                    â”‚
â”‚ åŸç½‘ç«™æœåŠ¡    â”‚          â”‚ Podman å®¹å™¨ (8081) â”‚
â”‚               â”‚          â”‚ â”œâ”€ Nginx (Alpine)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â””â”€ é™æ€æ–‡ä»¶         â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ›´æ–°æµç¨‹

```bash
# 1. æœ¬åœ°é‡æ–°æ„å»º
cd deployment
./build.sh
./save-image.sh

# 2. ä¸Šä¼ æ–°é•œåƒ
scp student-grouping-amd64.tar.gz root@121.40.124.135:/root/

# 3. æœåŠ¡å™¨æ›´æ–°
ssh root@121.40.124.135
podman stop student-grouping
podman rm student-grouping
podman rmi student-grouping:latest
gunzip -f student-grouping-amd64.tar.gz
podman load -i student-grouping-amd64.tar
podman run -d --name student-grouping -p 8081:80 --restart unless-stopped student-grouping:latest
```

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥

- [ ] åŸŸå DNS è§£æå·²é…ç½® (group.adapt-learn.online â†’ 121.40.124.135)
- [ ] æœåŠ¡å™¨å®‰å…¨ç»„å·²å¼€æ”¾ 80, 443, 8081 ç«¯å£
- [ ] æœåŠ¡å™¨å·²å®‰è£… Podman
- [ ] æœåŠ¡å™¨å·²å®‰è£… Nginx (ç”¨äºåå‘ä»£ç†)
- [ ] æœ¬åœ°å·²æ„å»ºé•œåƒ (`./build.sh`)
- [ ] é•œåƒå·²å¯¼å‡º (`./save-image.sh`)

### éƒ¨ç½²åéªŒè¯

- [ ] å®¹å™¨è¿è¡Œæ­£å¸¸ (`podman ps`)
- [ ] IP è®¿é—®æ­£å¸¸ (http://121.40.124.135:8081)
- [ ] åŸŸåè§£ææ­£ç¡® (`dig group.adapt-learn.online`)
- [ ] Nginx é…ç½®æ­£ç¡® (`nginx -t`)
- [ ] SSL è¯ä¹¦æœ‰æ•ˆ (https://group.adapt-learn.online)
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡ (ä¸Šä¼ /åˆ†ç»„/å¯¼å‡º)

## ğŸ†˜ é—®é¢˜æ’æŸ¥

### å¸¸è§é—®é¢˜é€ŸæŸ¥

| é—®é¢˜ | æ’æŸ¥å‘½ä»¤ | è§£å†³æ–¹æ¡ˆæ–‡æ¡£ |
|------|----------|--------------|
| å®¹å™¨æ— æ³•å¯åŠ¨ | `podman logs student-grouping` | DEPLOYMENT.md#æ•…éšœæ’æŸ¥ |
| æ— æ³•è®¿é—®ç½‘ç«™ | `ss -tlnp \| grep 8081` | DEPLOYMENT.md#æ•…éšœæ’æŸ¥ |
| SSL è¯ä¹¦å¤±è´¥ | `certbot certificates` | DEPLOYMENT.md#sslè¯ä¹¦é—®é¢˜ |
| æ–‡ä»¶ä¸Šä¼ å¤±è´¥ | æ£€æŸ¥ `client_max_body_size` | DEPLOYMENT.md#æ–‡ä»¶ä¸Šä¼ å¤±è´¥ |

---

**æ¸…å•ç‰ˆæœ¬**: 1.0
**ç”Ÿæˆæ—¥æœŸ**: 2025-10-04
**é€‚ç”¨ç³»ç»Ÿ**: Alibaba Cloud Linux 3.2104 LTS (AMD64)

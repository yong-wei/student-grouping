# 🎉 部署包生成完成

## ✅ 已生成文件总览

### 📦 统计信息
- **总文件数**: 21 个配置/脚本/文档文件
- **目录大小**: 135 MB (含完整源码)
- **生成时间**: 2025-10-04

### 📁 文件清单

```
deployment/
├── 📄 核心 Docker 文件 (3个)
│   ├── Dockerfile                 # 多阶段构建配置
│   ├── docker-compose.yml         # 容器编排配置
│   └── .dockerignore              # 构建排除规则
│
├── 🔧 部署脚本 (4个)
│   ├── build.sh                   # 构建 AMD64 镜像
│   ├── deploy.sh                  # 启动/重启容器
│   ├── save-image.sh              # 导出镜像为 tar.gz
│   └── stop.sh                    # 停止容器
│
├── ⚙️ Nginx 配置 (3个)
│   ├── nginx/
│   │   └── default.conf           # 容器内 Nginx 配置
│   └── nginx-vhost/
│       ├── group.adapt-learn.online.conf  # 宿主机虚拟主机配置
│       └── ssl-setup.sh           # SSL 自动配置脚本
│
├── 📚 文档 (4个)
│   ├── README.md                  # 部署包总览
│   ├── QUICKSTART.md              # 5分钟快速部署
│   ├── DEPLOYMENT.md              # 完整部署指南
│   └── CHECKLIST.md               # 部署清单与架构说明
│
└── 📁 app/                        # 完整项目源码 (135 MB)
```

## 🎯 部署方案说明

### ✅ 您的需求已完全实现

1. ✅ **子域名部署**: `group.adapt-learn.online` 访问本项目
2. ✅ **IP端口访问**: `121.40.124.135:8081` 直接访问
3. ✅ **保留原站点**: `adapt-learn.online` 继续运行原网站
4. ✅ **Docker化部署**: 多阶段构建,轻量化镜像
5. ✅ **AMD64架构**: 在 ARM64 Mac 上跨平台构建
6. ✅ **Podman兼容**: 所有脚本支持 Docker 和 Podman

### 🏗️ 部署架构

```
互联网
  │
  ├─→ adapt-learn.online (80/443)
  │     └─→ 原网站服务 (保持不变)
  │
  ├─→ group.adapt-learn.online (80/443)
  │     └─→ Nginx 反向代理 (宿主机)
  │           └─→ http://127.0.0.1:8081
  │                 └─→ Podman 容器
  │                       └─→ Nginx Alpine → 静态文件
  │
  └─→ 121.40.124.135:8081
        └─→ 直接访问 Podman 容器
```

## 🚀 快速开始

### 第一步: 本地构建镜像 (3-5分钟)

```bash
cd deployment
./build.sh
```

这将在您的 ARM64 Mac 上跨平台构建 AMD64 架构的镜像。

### 第二步: 导出镜像

```bash
./save-image.sh
```

生成文件: `student-grouping-amd64.tar.gz` (约 50-80 MB)

### 第三步: 上传到服务器

```bash
scp student-grouping-amd64.tar.gz root@121.40.124.135:/root/
```

### 第四步: 服务器部署

SSH 登录服务器:
```bash
ssh root@121.40.124.135

# 导入镜像
gunzip student-grouping-amd64.tar.gz
podman load -i student-grouping-amd64.tar

# 启动容器
podman run -d \
  --name student-grouping \
  -p 8081:80 \
  --restart unless-stopped \
  student-grouping:latest

# 验证
podman ps
curl http://localhost:8081
```

### 第五步: 配置域名访问 (可选)

#### 5.1 配置 Nginx 反向代理

```bash
# 上传配置文件
scp nginx-vhost/group.adapt-learn.online.conf \
  root@121.40.124.135:/etc/nginx/conf.d/

# 在服务器上
sudo nginx -t
sudo systemctl reload nginx
sudo firewall-cmd --permanent --add-service={http,https}
sudo firewall-cmd --reload
```

#### 5.2 配置 SSL 证书

```bash
# 上传并运行 SSL 脚本
scp nginx-vhost/ssl-setup.sh root@121.40.124.135:/root/

# SSH 到服务器
ssh root@121.40.124.135

# 编辑脚本修改邮箱,然后运行
vim /root/ssl-setup.sh
sudo bash /root/ssl-setup.sh
```

## 🌐 访问地址

部署完成后:

- **直接 IP 访问** (立即可用):
  - http://121.40.124.135:8081

- **域名访问** (需完成第五步):
  - http://group.adapt-learn.online (自动重定向 HTTPS)
  - https://group.adapt-learn.online (推荐)

- **原站点** (保持不变):
  - https://adapt-learn.online

## 📚 详细文档

| 文档 | 用途 | 适合人群 |
|------|------|----------|
| [QUICKSTART.md](QUICKSTART.md) | 5分钟快速部署 | 想快速上手的用户 |
| [DEPLOYMENT.md](DEPLOYMENT.md) | 完整部署指南 | 需要了解所有细节的用户 |
| [CHECKLIST.md](CHECKLIST.md) | 部署清单和架构 | 需要检查清单的用户 |
| [README.md](README.md) | 部署包总览 | 首次接触的用户 |

## 🔧 核心特性

### Docker 镜像特性
- ✅ 多阶段构建 (Node.js 编译 + Nginx 运行)
- ✅ 轻量化镜像 (基于 Alpine Linux)
- ✅ AMD64 架构 (兼容服务器)
- ✅ 健康检查 (自动重启失败容器)

### Nginx 配置特性
- ✅ SPA 路由支持 (try_files fallback)
- ✅ 文件上传限制 50MB (支持 Excel)
- ✅ Gzip 压缩
- ✅ 静态资源缓存
- ✅ 安全响应头

### 部署脚本特性
- ✅ Docker/Podman 自动检测
- ✅ 跨平台构建 (ARM64 → AMD64)
- ✅ 一键构建/部署/导出
- ✅ 彩色输出,易于理解

## 🔒 安全性

- ✅ HTTPS/SSL 支持 (Let's Encrypt 免费证书)
- ✅ 自动 HTTP → HTTPS 重定向
- ✅ 安全响应头 (HSTS, X-Frame-Options, CSP)
- ✅ 容器隔离
- ✅ 文件上传大小限制
- ✅ SSL 证书自动续期

## 📊 技术栈

### 构建环境
- macOS (ARM64)
- Docker / Podman
- Node.js 20.18.1
- Vite 7.x

### 运行环境
- Alibaba Cloud Linux 3.2104 LTS
- AMD64 (x86_64)
- Podman
- Nginx 1.27 (Alpine)

## 🆘 故障排查

常见问题和解决方案详见 [DEPLOYMENT.md#故障排查](DEPLOYMENT.md#故障排查)

快速诊断命令:
```bash
# 容器状态
podman ps -a
podman logs student-grouping

# 网络检查
ss -tlnp | grep 8081
curl http://localhost:8081

# Nginx 检查
sudo nginx -t
sudo systemctl status nginx

# DNS 检查
dig group.adapt-learn.online
```

## 🔄 更新维护

更新应用版本:
```bash
# 本地
cd deployment
./build.sh
./save-image.sh
scp student-grouping-amd64.tar.gz root@121.40.124.135:/root/

# 服务器
ssh root@121.40.124.135
podman stop student-grouping
podman rm student-grouping
gunzip -f student-grouping-amd64.tar.gz
podman load -i student-grouping-amd64.tar
podman run -d --name student-grouping -p 8081:80 --restart unless-stopped student-grouping:latest
```

## ✨ 下一步行动

1. **立即可做** (推荐):
   - 运行 `./build.sh` 构建镜像
   - 运行 `./deploy.sh` 本地测试
   - 访问 http://localhost:8081 验证

2. **准备部署**:
   - 运行 `./save-image.sh` 导出镜像
   - 上传镜像到服务器
   - 在服务器上导入并启动

3. **完善部署** (可选):
   - 配置 Nginx 反向代理
   - 配置 SSL 证书
   - 设置域名解析

## 📞 技术支持

如遇到问题,请检查:
1. 容器日志: `podman logs student-grouping`
2. Nginx 日志: `/var/log/nginx/error.log`
3. 详细文档: [DEPLOYMENT.md](DEPLOYMENT.md)

---

## 📋 部署验证清单

- [ ] 镜像构建成功 (`./build.sh`)
- [ ] 本地测试通过 (http://localhost:8081)
- [ ] 镜像导出成功 (`./save-image.sh`)
- [ ] 镜像上传到服务器
- [ ] 服务器导入镜像成功
- [ ] 容器启动成功 (`podman ps`)
- [ ] IP 访问正常 (http://121.40.124.135:8081)
- [ ] Nginx 配置正确 (`nginx -t`)
- [ ] 防火墙规则已添加
- [ ] SSL 证书配置成功 (可选)
- [ ] 域名访问正常 (https://group.adapt-learn.online)
- [ ] 功能测试通过 (上传/分组/导出)

---

**部署包版本**: 1.0
**生成日期**: 2025-10-04
**目标系统**: Alibaba Cloud Linux 3.2104 LTS (AMD64)
**目标服务器**: 121.40.124.135 (group.adapt-learn.online)

🎉 **部署包已准备就绪,祝您部署顺利!**
